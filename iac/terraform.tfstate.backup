{
  "version": 4,
  "terraform_version": "1.9.5",
  "serial": 71,
  "lineage": "9d8d7116-f11b-acb2-9754-d036e8b384be",
  "outputs": {
    "public_ip": {
      "value": "159.100.252.246",
      "type": "string"
    },
    "ssh_command": {
      "value": "ssh ubuntu@159.100.252.246",
      "type": "string"
    },
    "vm_id": {
      "value": "0c535e9c-6de7-4e75-b8e7-86e25ebf1397",
      "type": "string"
    }
  },
  "resources": [
    {
      "mode": "data",
      "type": "exoscale_template",
      "name": "ubuntu",
      "provider": "provider[\"registry.terraform.io/exoscale/exoscale\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "default_user": "ubuntu",
            "id": "06056cdc-f8c8-4d95-a2bc-b2a7862638c5",
            "name": "Linux Ubuntu 22.04 LTS 64-bit",
            "visibility": "public",
            "zone": "ch-dk-2"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "managed",
      "type": "exoscale_compute_instance",
      "name": "app",
      "provider": "provider[\"registry.terraform.io/exoscale/exoscale\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "anti_affinity_group_ids": null,
            "block_storage_volume_ids": null,
            "created_at": "2025-11-12 15:55:48 +0000 UTC",
            "deploy_target_id": "",
            "destroy_protected": null,
            "disk_size": 10,
            "elastic_ip_ids": null,
            "id": "0c535e9c-6de7-4e75-b8e7-86e25ebf1397",
            "ipv6": false,
            "ipv6_address": null,
            "labels": {},
            "mac_address": "06:d4:28:00:04:f9",
            "name": "currency-conversion-vm",
            "network_interface": [],
            "private": false,
            "private_network_ids": [],
            "public_ip_address": "159.100.252.246",
            "reverse_dns": "",
            "security_group_ids": [
              "d36dcb8d-a48c-43a8-aa91-95c0c2deff31"
            ],
            "ssh_key": "currency-conversion-vm-ssh",
            "ssh_keys": null,
            "state": "running",
            "template_id": "06056cdc-f8c8-4d95-a2bc-b2a7862638c5",
            "timeouts": null,
            "type": "standard.small",
            "user_data": "#cloud-config\r\npackage_update: true\r\npackages:\r\n  - sudo\r\n  - ca-certificates\r\n  - curl\r\n  - gnupg\r\n  - lsb-release\r\n\r\nruncmd:\r\n  # --- Allow ubuntu user to use sudo ---\r\n  - usermod -aG sudo ubuntu\r\n  - echo \"ubuntu ALL=(ALL) NOPASSWD:ALL\" \u003e\u003e /etc/sudoers.d/90-cloud-init-users\r\n\r\n  # --- Wait for network and apt to be ready ---\r\n  - sleep 20\r\n\r\n  # --- Install Docker ---\r\n  - mkdir -p /etc/apt/keyrings\r\n  - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | gpg --dearmor -o /etc/apt/keyrings/docker.gpg\r\n  - echo \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] \\\r\n      https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\" \u003e /etc/apt/sources.list.d/docker.list\r\n  - apt-get update -y || sleep 10 \u0026\u0026 apt-get update -y\r\n  - apt-get install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin\r\n  - systemctl enable docker\r\n  - systemctl start docker\r\n  - systemctl status docker || journalctl -u docker --no-pager\r\n\r\n  # --- Create app directory ---\r\n  - mkdir -p /opt/price-server\r\n  - cd /opt/price-server\r\n\r\n  # --- Write Flask app to file ---\r\n  - echo '#!/usr/bin/env python3\r\nfrom flask import Flask, jsonify\r\nimport requests, time, json, os\r\napp = Flask(__name__)\r\nCACHE_FILE = \"/opt/price-server/price_cache.json\"\r\nAPI_URL = \"https://api.coingecko.com/api/v3/simple/price?ids=bitcoin\u0026vs_currencies=usd\"\r\nCACHE_TTL = 60\r\ndef get_price():\r\n    if os.path.exists(CACHE_FILE):\r\n        age = time.time() - os.path.getmtime(CACHE_FILE)\r\n        if age \u003c CACHE_TTL:\r\n            with open(CACHE_FILE) as f:\r\n                return json.load(f)\r\n    try:\r\n        r = requests.get(API_URL, timeout=10)\r\n        r.raise_for_status()\r\n        data = r.json()\r\n        os.makedirs(os.path.dirname(CACHE_FILE), exist_ok=True)\r\n        with open(CACHE_FILE, \"w\") as f:\r\n            json.dump(data, f)\r\n        return data\r\n    except Exception as e:\r\n        if os.path.exists(CACHE_FILE):\r\n            with open(CACHE_FILE) as f:\r\n                return json.load(f)\r\n        return {\"error\": str(e)}\r\n@app.route(\"/\")\r\ndef index():\r\n    return jsonify(get_price())\r\nif __name__ == \"__main__\":\r\n    app.run(host=\"0.0.0.0\", port=80)' \u003e /opt/price-server/app.py\r\n\r\n  # --- Create Dockerfile for Flask app ---\r\n  - echo 'FROM python:3.10-slim\r\nWORKDIR /opt/price-server\r\nCOPY app.py .\r\nRUN pip install flask requests\r\nEXPOSE 80\r\nCMD [\"python\", \"app.py\"]' \u003e /opt/price-server/Dockerfile\r\n\r\n  # --- Build and run container ---\r\n  - docker build -t price-server /opt/price-server\r\n  - docker run -d --name price-server -p 80:80 --restart unless-stopped price-server\r\n",
            "zone": "ch-dk-2"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozNjAwMDAwMDAwMDAwLCJkZWxldGUiOjM2MDAwMDAwMDAwMDAsInJlYWQiOjM2MDAwMDAwMDAwMDAsInVwZGF0ZSI6MzYwMDAwMDAwMDAwMH19",
          "dependencies": [
            "data.exoscale_template.ubuntu",
            "exoscale_security_group.svc",
            "exoscale_ssh_key.local"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "exoscale_compute_instance",
      "name": "app2",
      "provider": "provider[\"registry.terraform.io/exoscale/exoscale\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "anti_affinity_group_ids": null,
            "block_storage_volume_ids": null,
            "created_at": "2025-11-12 15:55:48 +0000 UTC",
            "deploy_target_id": "",
            "destroy_protected": null,
            "disk_size": 10,
            "elastic_ip_ids": null,
            "id": "63281204-793c-4536-bde4-cf272f8c4f6e",
            "ipv6": false,
            "ipv6_address": null,
            "labels": {},
            "mac_address": "06:ef:48:00:02:fe",
            "name": "currency-conversion-vm-2",
            "network_interface": [],
            "private": false,
            "private_network_ids": [],
            "public_ip_address": "159.100.250.246",
            "reverse_dns": "",
            "security_group_ids": [
              "d36dcb8d-a48c-43a8-aa91-95c0c2deff31"
            ],
            "ssh_key": "currency-conversion-vm-ssh",
            "ssh_keys": null,
            "state": "running",
            "template_id": "06056cdc-f8c8-4d95-a2bc-b2a7862638c5",
            "timeouts": null,
            "type": "standard.small",
            "user_data": "#cloud-config\r\npackage_update: true\r\npackages:\r\n  - sudo\r\n  - ca-certificates\r\n  - curl\r\n  - gnupg\r\n  - lsb-release\r\n\r\nruncmd:\r\n  # --- Allow ubuntu user to use sudo ---\r\n  - usermod -aG sudo ubuntu\r\n  - echo \"ubuntu ALL=(ALL) NOPASSWD:ALL\" \u003e\u003e /etc/sudoers.d/90-cloud-init-users\r\n\r\n  # --- Wait for network and apt to be ready ---\r\n  - sleep 20\r\n\r\n  # --- Install Docker ---\r\n  - mkdir -p /etc/apt/keyrings\r\n  - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | gpg --dearmor -o /etc/apt/keyrings/docker.gpg\r\n  - echo \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] \\\r\n      https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\" \u003e /etc/apt/sources.list.d/docker.list\r\n  - apt-get update -y || sleep 10 \u0026\u0026 apt-get update -y\r\n  - apt-get install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin\r\n  - systemctl enable docker\r\n  - systemctl start docker\r\n  - systemctl status docker || journalctl -u docker --no-pager\r\n\r\n  # --- Create app directory ---\r\n  - mkdir -p /opt/price-server\r\n  - cd /opt/price-server\r\n\r\n  # --- Write Flask app to file ---\r\n  - echo '#!/usr/bin/env python3\r\nfrom flask import Flask, jsonify\r\nimport requests, time, json, os\r\napp = Flask(__name__)\r\nCACHE_FILE = \"/opt/price-server/price_cache.json\"\r\nAPI_URL = \"https://api.coingecko.com/api/v3/simple/price?ids=bitcoin\u0026vs_currencies=usd\"\r\nCACHE_TTL = 60\r\ndef get_price():\r\n    if os.path.exists(CACHE_FILE):\r\n        age = time.time() - os.path.getmtime(CACHE_FILE)\r\n        if age \u003c CACHE_TTL:\r\n            with open(CACHE_FILE) as f:\r\n                return json.load(f)\r\n    try:\r\n        r = requests.get(API_URL, timeout=10)\r\n        r.raise_for_status()\r\n        data = r.json()\r\n        os.makedirs(os.path.dirname(CACHE_FILE), exist_ok=True)\r\n        with open(CACHE_FILE, \"w\") as f:\r\n            json.dump(data, f)\r\n        return data\r\n    except Exception as e:\r\n        if os.path.exists(CACHE_FILE):\r\n            with open(CACHE_FILE) as f:\r\n                return json.load(f)\r\n        return {\"error\": str(e)}\r\n@app.route(\"/\")\r\ndef index():\r\n    return jsonify(get_price())\r\nif __name__ == \"__main__\":\r\n    app.run(host=\"0.0.0.0\", port=80)' \u003e /opt/price-server/app.py\r\n\r\n  # --- Create Dockerfile for Flask app ---\r\n  - echo 'FROM python:3.10-slim\r\nWORKDIR /opt/price-server\r\nCOPY app.py .\r\nRUN pip install flask requests\r\nEXPOSE 80\r\nCMD [\"python\", \"app.py\"]' \u003e /opt/price-server/Dockerfile\r\n\r\n  # --- Build and run container ---\r\n  - docker build -t price-server /opt/price-server\r\n  - docker run -d --name price-server -p 80:80 --restart unless-stopped price-server\r\n",
            "zone": "ch-dk-2"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozNjAwMDAwMDAwMDAwLCJkZWxldGUiOjM2MDAwMDAwMDAwMDAsInJlYWQiOjM2MDAwMDAwMDAwMDAsInVwZGF0ZSI6MzYwMDAwMDAwMDAwMH19",
          "dependencies": [
            "data.exoscale_template.ubuntu",
            "exoscale_security_group.svc",
            "exoscale_ssh_key.local"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "exoscale_security_group",
      "name": "svc",
      "provider": "provider[\"registry.terraform.io/exoscale/exoscale\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "description": "Allow SSH, HTTP, HTTPS, and all outbound",
            "external_sources": null,
            "id": "d36dcb8d-a48c-43a8-aa91-95c0c2deff31",
            "name": "currency-conversion-vm-sg",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozNjAwMDAwMDAwMDAwLCJkZWxldGUiOjM2MDAwMDAwMDAwMDAsInJlYWQiOjM2MDAwMDAwMDAwMDB9LCJzY2hlbWFfdmVyc2lvbiI6IjEifQ=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "exoscale_security_group_rule",
      "name": "allow_http",
      "provider": "provider[\"registry.terraform.io/exoscale/exoscale\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "cidr": "0.0.0.0/0",
            "description": "Allow HTTP",
            "end_port": 80,
            "icmp_code": null,
            "icmp_type": null,
            "id": "628c4892-232e-4a06-aff5-50dfb48fe7c2",
            "protocol": "TCP",
            "public_security_group": null,
            "security_group": "currency-conversion-vm-sg",
            "security_group_id": "d36dcb8d-a48c-43a8-aa91-95c0c2deff31",
            "start_port": 80,
            "timeouts": null,
            "type": "INGRESS",
            "user_security_group": null,
            "user_security_group_id": null
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozNjAwMDAwMDAwMDAwLCJkZWxldGUiOjM2MDAwMDAwMDAwMDAsInJlYWQiOjM2MDAwMDAwMDAwMDB9fQ==",
          "dependencies": [
            "exoscale_security_group.svc"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "exoscale_security_group_rule",
      "name": "allow_https",
      "provider": "provider[\"registry.terraform.io/exoscale/exoscale\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "cidr": "0.0.0.0/0",
            "description": "Allow HTTPS",
            "end_port": 443,
            "icmp_code": null,
            "icmp_type": null,
            "id": "b83d256c-4284-4bb0-9e3f-8dff95025727",
            "protocol": "TCP",
            "public_security_group": null,
            "security_group": "currency-conversion-vm-sg",
            "security_group_id": "d36dcb8d-a48c-43a8-aa91-95c0c2deff31",
            "start_port": 443,
            "timeouts": null,
            "type": "INGRESS",
            "user_security_group": null,
            "user_security_group_id": null
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozNjAwMDAwMDAwMDAwLCJkZWxldGUiOjM2MDAwMDAwMDAwMDAsInJlYWQiOjM2MDAwMDAwMDAwMDB9fQ==",
          "dependencies": [
            "exoscale_security_group.svc"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "exoscale_security_group_rule",
      "name": "allow_ssh",
      "provider": "provider[\"registry.terraform.io/exoscale/exoscale\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "cidr": "0.0.0.0/0",
            "description": "Allow SSH",
            "end_port": 22,
            "icmp_code": null,
            "icmp_type": null,
            "id": "a2bb5ffd-f682-4882-b652-bd01500012d7",
            "protocol": "TCP",
            "public_security_group": null,
            "security_group": "currency-conversion-vm-sg",
            "security_group_id": "d36dcb8d-a48c-43a8-aa91-95c0c2deff31",
            "start_port": 22,
            "timeouts": null,
            "type": "INGRESS",
            "user_security_group": null,
            "user_security_group_id": null
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozNjAwMDAwMDAwMDAwLCJkZWxldGUiOjM2MDAwMDAwMDAwMDAsInJlYWQiOjM2MDAwMDAwMDAwMDB9fQ==",
          "dependencies": [
            "exoscale_security_group.svc"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "exoscale_security_group_rule",
      "name": "egress_all",
      "provider": "provider[\"registry.terraform.io/exoscale/exoscale\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "cidr": "0.0.0.0/0",
            "description": "Allow all outbound",
            "end_port": 65535,
            "icmp_code": null,
            "icmp_type": null,
            "id": "ac25649a-4453-4432-83a2-8445485ac427",
            "protocol": "TCP",
            "public_security_group": null,
            "security_group": "currency-conversion-vm-sg",
            "security_group_id": "d36dcb8d-a48c-43a8-aa91-95c0c2deff31",
            "start_port": 1,
            "timeouts": null,
            "type": "EGRESS",
            "user_security_group": null,
            "user_security_group_id": null
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozNjAwMDAwMDAwMDAwLCJkZWxldGUiOjM2MDAwMDAwMDAwMDAsInJlYWQiOjM2MDAwMDAwMDAwMDB9fQ==",
          "dependencies": [
            "exoscale_security_group.svc"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "exoscale_ssh_key",
      "name": "local",
      "provider": "provider[\"registry.terraform.io/exoscale/exoscale\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "fingerprint": "ae:0a:ff:8b:09:5f:91:3b:3a:6a:fa:60:40:b4:f9:a3",
            "id": "currency-conversion-vm-ssh",
            "name": "currency-conversion-vm-ssh",
            "public_key": "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILatBIoqbOgpMVKThcysLY2IbPKSko72MS/pKbnPtM0y safae.siraji@edu.fh-joanneum.at",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozNjAwMDAwMDAwMDAwLCJkZWxldGUiOjM2MDAwMDAwMDAwMDAsInJlYWQiOjM2MDAwMDAwMDAwMDB9fQ=="
        }
      ]
    }
  ],
  "check_results": null
}
